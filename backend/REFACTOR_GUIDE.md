# 后端项目重构指南

## 项目模块化重构说明

本项目已经开始进行模块化重构，将原本混合在一起的功能按照业务逻辑拆分到独立的模块中。

### 已完成的模块迁移

#### 1. 认证授权模块 (`modules/auth/`)
- **models.py**: 认证相关的数据模型（登录、注册、Token等）
- **service.py**: 认证业务逻辑（密码验证、Token生成等）
- **deps.py**: 认证相关的依赖注入
- **router.py**: 认证相关的API路由

包含功能：
- 用户登录/登出
- Token管理
- 密码修改/重置
- 用户注册

#### 2. 用户管理模块 (`modules/users/`)
- **models.py**: 用户相关的数据模型
- **service.py**: 用户管理业务逻辑
- **router.py**: 用户管理API路由

包含功能：
- 用户CRUD操作
- 角色权限管理
- 用户信息更新

### 模块化架构优势

1. **清晰的代码组织**: 每个模块负责独立的业务功能
2. **更好的可维护性**: 修改某个功能只需关注对应模块
3. **便于团队协作**: 不同开发者可以并行开发不同模块
4. **易于测试**: 每个模块可以独立测试
5. **灵活的扩展性**: 新功能可以作为新模块添加

### 向后兼容性

为了保证现有代码的正常运行，在 `app/` 目录下保留了兼容层：
- `app/models.py`: 导入并导出所有模型
- `app/crud.py`: 导入并导出所有CRUD函数
- `app/api/deps.py`: 导入并导出所有依赖
- `app/core/security.py`: 导入并导出安全相关函数

### 待迁移的模块

根据项目模块划分文档，后续需要迁移的模块包括：

1. **微信账号管理模块**
2. **客户数据管理模块** 
3. **会话与消息管理模块**
4. **知识库管理模块**
5. **自动化与任务模块**

### 迁移步骤指南

迁移新模块时，请按照以下步骤：

1. 在 `modules/` 下创建模块目录
2. 创建模块文件：
   - `__init__.py`: 模块说明
   - `models.py`: 数据模型
   - `service.py`: 业务逻辑
   - `deps.py`: 依赖注入（如需要）
   - `router.py`: API路由
3. 更新 `app/api/main.py` 导入新路由
4. 在兼容层中导出相关函数和模型
5. 测试确保功能正常

### 注意事项

1. 模块间的循环依赖要避免
2. 公共功能放在 `app/core/` 或 `app/utils.py`
3. 每个模块应该是独立且内聚的
4. 保持接口的一致性和向后兼容性 
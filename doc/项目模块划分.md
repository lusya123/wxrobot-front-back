# 项目模块划分

本文档旨在梳理和定义 `wxbot_back_front` 项目的整体功能模块。项目主要由三大部分组成: 核心机器人、后端服务 和 前端管理后台。

## 1. 核心机器人模块 (`wechat_bot.py`)

这是整个项目的核心,直接与微信进行交互,负责消息的接收和处理。

- **1.1. 微信客户端集成**:
  - 使用 `wechaty` 或类似库登录和管理机器人账号。
  - 维持与微信服务器的心跳和连接。

- **1.2. 事件监听与响应**:
  - 监听各类微信事件,如: 登录、登出、扫码、消息、好友请求、入群邀请等。
  - 将事件分发到对应的处理逻辑。

- **1.3. 消息处理引擎**:
  - **消息解析**: 解析文本、图片、语音、视频、链接等不同类型的消息。
  - **指令系统**: 识别特定指令(如 `!help`)并执行相应操作。
  - **智能问答**: 对接知识库或 AI 模型,实现自动回复。
  - **消息转发**: 根据预设规则将消息转发给其他用户或群聊。

- **1.4. API 联动**:
  - 调用后端 API,上报消息数据、获取指令、查询用户信息等。
  - 接收后端通过 API 推送的指令,如主动发送消息。

## 2. 后端服务模块 (`backend/`)

基于 Python (FastAPI) 构建,为前端提供数据支持和业务逻辑处理,并为机器人提供指令和数据接口。

- **2.1. 用户认证与授权 (`/api/routes/auth.py`, `/api/routes/login.py`)**:
  - **用户注册与登录**: 提供后台用户的账户管理功能。
  - **JWT 鉴权**: 使用 Token 对 API 请求进行身份验证。
  - **密码管理**: 包括密码修改、重置等。

- **2.2. 用户管理模块 (`/api/routes/users.py`)**:
  - 提供对后台系统用户的增、删、改、查 (CRUD) 功能。
  - 用户角色与权限管理。

- **2.3. 微信账号管理模块**:
  - 关联和管理机器人账号信息。
  - 控制机器人登录、登出状态。

- **2.4. 客户数据管理模块 (`/api/routes/items.py` or similar)**:
  - 存储和管理从微信同步过来的好友、群聊信息。
  - 客户标签、分组、备注等功能。

- **2.5. 会话与消息管理模块**:
  - 存储机器人与用户的聊天记录。
  - 提供消息查询、检索接口。

- **2.6. 知识库管理模块**:
  - 知识库内容的增、删、改、查。
  - 提供知识库检索接口,供机器人进行智能问答。

- **2.7. 自动化与任务模块**:
  - 定时任务管理(如定时发送消息)。
  - 关键词回复规则管理。

- **2.8. 数据库与模型 (`/models.py`, `/crud.py`)**:
  - 使用 SQLAlchemy ORM 定义所有数据模型。
  - 封装对数据库的通用增删改查操作。
  - 使用 Alembic 进行数据库结构迁移管理。

## 3. 前端应用模块 (`wechat-sales-assistant/`)

基于 Next.js (React) 构建的单页应用(SPA),为运营人员提供一个可视化、可操作的管理后台。

- **3.1. 登录页面 (`/app/login`)**:
  - 用户登录表单和身份验证。

- **3.2. 主控台/仪表盘 (`/app/dashboard`)**:
  - 展示核心业务数据,如: 今日消息量、新增好友数、机器人状态等。
  - 常用功能的快捷入口。

- **3.3. 会话中心 (`/app/conversations`)**:
  - 实时查看机器人接收和发送的消息。
  - 选择指定好友或群聊进行聊天。
  - 手动发送消息(文本、图片等)。

- **3.4. 客户管理 (`/app/customers`)**:
  - 以列表形式展示所有好友和群聊。
  - 查看客户详情、聊天记录。
  - 对客户进行打标签、备注等操作。

- **3.5. 预约管理 (`/app/appointments`)**:
  - 记录和管理与客户的预约事项。
  - 日历视图展示。

- **3.6. 知识库管理 (`/app/knowledge`)**:
  - 提供 UI 界面,方便运营人员添加、编辑和删除知识库条目。
  - 问答对(Q&A)的录入和管理。

- **3.7. 微信账号管理 (`/app/wechat-accounts`)**:
  - 展示当前绑定的机器人账号。
  - 提供扫码登录、登出操作按钮。

- **3.8. 系统设置 (`/app/settings`)**:
  - **个人设置**: 修改当前登录用户的密码、头像等。
  - **机器人设置**: 配置机器人的自动回复规则、欢迎语等。

- **3.9. 管理员功能 (`/app/admin`)**:
  - **用户管理**: 管理后台系统的所有用户账号。
  - **系统监控**: 查看系统日志和运行状态。

## 4. 通用及测试模块

- **4.1. 接口定义与数据模型**:
  - 前后端共享的数据结构定义(TypeScript/Python)。

- **4.2. 测试 (`tests/`)**:
  - **单元测试**: 对后端的核心函数和类进行测试。
  - **API 测试**: 对后端的 API 接口进行集成测试。
  - **E2E 测试**: 对前端的关键用户流程进行端到端测试。 